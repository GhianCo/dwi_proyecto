<div class="absolute inset-0 flex flex-col min-w-0 overflow-hidden">
  <mat-drawer-container
    class="flex-auto h-full bg-card dark:bg-transparent"
    (backdropClick)="onBackdropClicked()"
  >
    <!-- Drawer -->
    <mat-drawer
      class="w-full md:w-240 dark:bg-gray-900"
      [mode]="drawerMode"
      [opened]="false"
      [position]="'end'"
      [disableClose]="true"
      #matDrawer
    >
      <router-outlet></router-outlet>
    </mat-drawer>

    <mat-drawer-content>
      <form [formGroup]="form">
        <div
          class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent"
          *ngIf="clienteStore.vm() as vm"
          [appLoading]="vm.clienteLoading || vm.createUpdateStateClienteLoading"
        >
          <div
            class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent"
          >
            <div
              class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-8 px-6 md:px-8"
            >
              <div>
                <div class="text-2xl font-extrabold tracking-tight leading-none">
                  Cliente
                </div>
              </div>
              <div class="flex items-center mt-4 sm:mt-0 w-full">
                <div class="flex-auto md:mx-32">
                  <!-- <mat-form-field
                    class="mat-dense mat-no-subscript mat-rounded w-full min-w-50"
                  >
                    <mat-icon
                      class="icon-size-4 mr-2"
                      [svgIcon]="'heroicons_outline:magnifying-glass'"
                    ></mat-icon>
                    <input
                      matInput
                      #searchStateFixedassetText
                      [autocomplete]="'off'"
                      (keyup)="
                        searchTipoDocumentoByQuery(
                          searchStateFixedassetText.value
                        )
                      "
                      [placeholder]="'Busqueda...'"
                    />
                  </mat-form-field> -->
                </div>
                <button
                  class="ml-4"
                  mat-flat-button
                  [color]="'accent'"
                  (click)="loadAllStatesFixedAsset()"
                  [disabled]="vm.proveedorLoading"
                >
                  <mat-icon [svgIcon]="'heroicons_outline:arrow-path'"></mat-icon>
                  <span class="ml-2 mr-1">Actualizar</span>
                </button>
                <button
                  class="ml-4"
                  mat-flat-button
                  [color]="'primary'"
                  [routerLink]="['./new']"
                >
                  <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                  <span class="ml-2 mr-1">Agregar</span>
                </button>
              </div>
            </div>

            <div class="px-6 md:px-8 flex items-center gap-2 border-b mb-2">
              <div class="w-72">
                <div class="flex gap-2 w-full">
                  <h3 class="font-semibold inline-block" >Filtrar por: </h3>
                  <mat-form-field class="mat-no-subscript" style="flex-grow: 1;">
                    <mat-select formControlName="tipoFiltro" (selectionChange)="changeFiltroSelected($event)">
                      <mat-option [value]="filtro.tipo" *ngFor="let filtro of filtrosList">
                        {{ filtro.value }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                
              </div>
              <div class="w-120">
                <mat-form-field
                    class="mat-dense mat-no-subscript mat-rounded w-full min-w-50"
                  >
                    <mat-icon
                      class="icon-size-4 mr-2"
                      [svgIcon]="'heroicons_outline:magnifying-glass'"
                    ></mat-icon>
                    <input
                      matInput
                      #searchStateFixedassetText
                      [autocomplete]="'off'"
                      (keyup)="
                        searchTipoDocumentoByQuery(
                          searchStateFixedassetText.value
                        )
                      "
                      [placeholder]="'Busqueda...'"
                    />
                  </mat-form-field>
              </div>
            </div>
            <div class="flex flex-auto overflow-hidden">
              <div
                class="flex flex-col flex-auto sm:mb-18 overflow-hidden sm:overflow-y-auto"
              >
                <!-- <ng-container *ngIf="vm.proveedorData.length"> -->
                <ng-container *ngIf="vm.clienteData.length">
                  <div class="flex flex-col">
                    <div class="overflow-x-auto sm:-mx-6 lg:-mx-8">
                      <div class="py-2 inline-block min-w-full sm:px-6 lg:px-8">
                        <div class="overflow-hidden">
                          <table class="min-w-full py-4 px-6">
                            <thead
                              class="py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                            >
                              <tr>
                                <th class="font-bold px-6 py-4 text-left">
                                  Nombres
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Nombre comercial
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Tipo documento
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Número
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Cód. Interno
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Días de crédito
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Linea de credito
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Correo
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Telefono
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Departamento
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Provincia
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Distrito
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  Activo
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                  ¿Bloqueado?
                                </th>
                                <th class="font-bold px-6 py-4 text-left">
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <ng-container *ngFor="let cliente of vm.clienteData">
                                <tr
                                  class="border-b"
                                  [ngClass]="{
                                    'bg-gray-100':
                                      vm.clienteSelected?.cliente_id == cliente.proveedor_id,
                                  }"
                                >
                                  <td class="px-6 py-4 font-medium text-sm">
                                    {{ cliente.cliente_nombres }} {{ cliente.cliente_apellidos }}
                                  </td>
                                  <td class="px-6 py-4 font-medium">
                                    <ng-container *ngIf="cliente.cliente_nombrecomercial">
                                      {{ cliente.cliente_nombrecomercial }} 
                                    </ng-container>
                                    
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    <ng-container *ngIf="cliente.tipodocumento && cliente.tipodocumento.tipodocumento_descripcion">
                                      {{ cliente.tipodocumento?.tipodocumento_descripcion }}
                                    </ng-container>
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    {{ cliente.cliente_documento }}
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    {{ cliente.cliente_codigointerno }}
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                     {{ cliente.cliente_diascredito }}
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    {{ simboloMoneda }} {{ cliente.cliente_lineacredito | currencyFormat}}
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    {{ cliente.cliente_correo }}
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    <ng-container *ngIf="cliente.direcciones && cliente.direcciones.length > 0  && cliente.direcciones[0] && cliente.direcciones[0].direccioncliente_telefono">
                                      {{ cliente.direcciones[0].direccioncliente_telefono }}
                                    </ng-container>
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    <ng-container *ngIf="cliente.direcciones && cliente.direcciones.length > 0  && cliente.direcciones[0] && cliente.direcciones[0].departamento">
                                      {{ cliente.direcciones[0].departamento.departamento_descripcion }}
                                    </ng-container>
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    <ng-container *ngIf="cliente.direcciones && cliente.direcciones.length > 0  && cliente.direcciones[0] && cliente.direcciones[0].provincia">
                                      {{ cliente.direcciones[0].provincia.provincia_descripcion }}
                                    </ng-container>
                                  </td>
                                  <td class="px-6 py-4 font-medium text-sm">
                                    <ng-container *ngIf="cliente.direcciones && cliente.direcciones.length > 0  && cliente.direcciones[0] && cliente.direcciones[0].distrito">
                                        {{ cliente.direcciones[0].distrito.distrito_descripcion }}
                                      </ng-container>
                                  </td>
                                  <td class="px-6 py-4">
                                    @if (cliente.cliente_activo) {
                                      <mat-icon
                                        class="text-green-400"
                                        [svgIcon]="'heroicons_outline:check'"
                                      ></mat-icon>
                                    } @else {
                                      <mat-icon
                                        class="text-red-400"
                                        [svgIcon]="'heroicons_outline:x-mark'"
                                      ></mat-icon>
                                    }
                                  </td>
                                  <td class="px-6 py-4 text-right">
                                    <p *ngIf="cliente.cliente_bloqueadopordeudapendiente" class="bg-red-600 text-white rounded-full px-2 py-1 text-xs w-fit mb-2 text-nowrap">
                                      Por deuda pendiente
                                    </p>
                                    <p *ngIf="cliente.cliente_bloqueadoporlineadecredito" class="bg-red-600 text-white rounded-full px-2 py-1 text-xs w-fit mb-2 text-nowrap">
                                      Bloqueado por linea de credito
                                    </p>
                                  </td>
                                  <td class="px-6 py-4 text-right">
                                    <div class="flex gap-2">
                                      <a
                                        class="min-w-10 min-h-7 h-7 px-2 leading-6"
                                        mat-stroked-button
                                        [routerLink]="['./', cliente.cliente_id]"
                                      >
                                        <mat-icon
                                          [svgIcon]="'heroicons_outline:eye'"
                                        ></mat-icon>
                                      </a>

                                      <button mat-icon-button [matMenuTriggerFor]="menu">
                                        <mat-icon>more_vert</mat-icon>
                                      </button>
                                      <mat-menu #menu="matMenu">
                                        <button mat-menu-item 
                                          *ngIf="!cliente.cliente_bloqueadopordeudapendiente"
                                          (click)="bloquearPorDeudaPendiete(cliente)"
                                        >
                                          <!-- <mat-icon>dialpad</mat-icon> -->
                                          <span>Bloquear por deuda pendiente</span>
                                        </button>

                                        <button mat-menu-item 
                                          *ngIf="cliente.cliente_bloqueadopordeudapendiente"
                                          (click)="desbloquearPorDeudaPendiete(cliente)"  
                                        >
                                          <!-- <mat-icon>dialpad</mat-icon> -->
                                          <span>Desbloquear por deuda pendiente</span>
                                        </button>


                                        <button mat-menu-item 
                                          *ngIf="!cliente.cliente_bloqueadoporlineadecredito"
                                          (click)="bloquearPorLineaDeCredito(cliente)"
                                        >
                                          <!-- <mat-icon>dialpad</mat-icon> -->
                                          <span>Bloquear por linea de credito</span>
                                        </button>

                                        <button mat-menu-item 
                                          *ngIf="cliente.cliente_bloqueadoporlineadecredito"
                                          (click)="desbloquearPorLineaDeCredito(cliente)"
                                        >
                                          <!-- <mat-icon>dialpad</mat-icon> -->
                                          <span>Desbloquear por linea de credito</span>
                                        </button>

                                      </mat-menu>
                                    </div>
                                  </td>
                                </tr>
                              </ng-container>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  <mat-paginator
                    class="sm:absolute sm:inset-x-0 sm:bottom-0 border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                    (page)="changePagination($event)"
                    [ngClass]="{ 'pointer-events-none': vm.clienteLoading }"
                    [length]="vm.clientePagination?.totalRows"
                    [pageIndex]="vm.clientePagination?.currentPage - 1"
                    [pageSize]="vm.filterClienteToApply?.perPage"
                    [pageSizeOptions]="[10, 25, 100]"
                    [showFirstLastButtons]="true"
                  ></mat-paginator>
                </ng-container>

                <div
                  *ngIf="!vm.clienteData.length && !vm.clienteLoading"
                  class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center"
                >
                  No se encontraron registros!
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
